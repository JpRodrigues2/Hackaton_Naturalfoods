<!DOCTYPE html>
<html lang="pt-br" ng-app="literalCafeApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafios - Literal Café</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"></script>
    <style>
        /* [ ... mesmo CSS que você forneceu ... ] */
        /* Mantido exatamente igual por você já ter deixado perfeito :) */
    </style>
</head>
<body ng-controller="DesafiosController">
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-box">//</div>
                <div class="title">Desafios</div>
            </div>
        </div>

        <div class="loading" ng-if="loading">
            Carregando desafios...
        </div>
        
        <div class="error" ng-if="error">
            Ocorreu um erro ao carregar os desafios. Por favor, tente novamente.
        </div>

        <div class="challenges-list" ng-if="!loading && !error">
            <div class="challenge-item" ng-repeat="challenge in challenges">
                <div class="challenge-icon">
                    <img ng-src="{{getIconForChallenge(challenge)}}" alt="Ícone do desafio">
                </div>
                <div class="challenge-info">
                    <div class="challenge-title">{{challenge.challenge}}</div>
                    <div class="challenge-description">{{challenge.description}}</div>
                    <div class="challenge-points">{{getRewardPoints(challenge)}} pontos</div>
                </div>
            </div>
        </div>

        <div class="navbar">
            <div class="nav-item" ng-class="{'active': currentPage === 'status.html'}" ng-click="navigateTo('status.html')">
                <span class="nav-icon">📊</span>
                Status
            </div>
            <div class="nav-item" ng-class="{'active': currentPage === 'challenges.html'}" ng-click="navigateTo('challenges.html')">
                <span class="nav-icon">🎯</span>
                Desafios
            </div>
            <div class="nav-item" ng-class="{'active': currentPage === 'leaderboard.html'}" ng-click="navigateTo('leaderboard.html')">
                <span class="nav-icon">🏆</span>
                Ranking
            </div>
            <div class="nav-item" ng-class="{'active': currentPage === 'prizes.html'}" ng-click="navigateTo('prizes.html')">
                <span class="nav-icon">🎁</span>
                Prêmios
            </div>
        </div>
    </div>

    <script>
        angular.module('literalCafeApp', [])
            .controller('DesafiosController', ['$scope', '$http', function($scope, $http) {
                $scope.challenges = [];
                $scope.loading = true;
                $scope.error = false;
                
                $scope.currentPage = window.location.pathname.split('/').pop();

                $scope.navigateTo = function(page) {
                    window.location.href = page;
                };

                var challengeIcons = {
                    'comprar': 'https://cdn-icons-png.flaticon.com/512/3081/3081559.png',
                    'convidar': 'https://cdn-icons-png.flaticon.com/512/2497/2497892.png',
                    'compartilhar': 'https://cdn-icons-png.flaticon.com/512/2065/2065062.png',
                    'default': 'https://cdn-icons-png.flaticon.com/512/1087/1087927.png'
                };

                $scope.getIconForChallenge = function(challenge) {
                    if (challenge.rules && challenge.rules.length > 0) {
                        var actionId = challenge.rules[0].actionId;
                        if (challenge.challenge.toLowerCase().includes('comprar') || actionId === 'comprar') {
                            return challengeIcons.comprar;
                        } else if (challenge.challenge.toLowerCase().includes('convidar') || actionId === 'convidar') {
                            return challengeIcons.convidar;
                        } else if (challenge.challenge.toLowerCase().includes('compartilhar') || actionId === 'compartilhar') {
                            return challengeIcons.compartilhar;
                        }
                    }
                    return challengeIcons.default;
                };

                $scope.getRewardPoints = function(challenge) {
                    if (challenge.points && challenge.points.length > 0) {
                        for (var i = 0; i < challenge.points.length; i++) {
                            if (challenge.points[i].category === 'xp') {
                                return challenge.points[i].total;
                            }
                        }
                        return challenge.points[0].total;
                    }
                    return 0;
                };

                // NOVA REQUISIÇÃO COM NOVO TOKEN
                var req = {
                    method: 'GET',
                    url: 'https://service2.funifier.com/v3/challenge',
                    headers: {
                        "Authorization": "Bearer eyJhbGciOiJIUzUxMiIsImNhbGciOiJHWklQIn0.H4sIAAAAAAAAAD2LSwrCMBQAryJvnUWTNB_cC0KXHkBek1cIBBOSVC3i3Y0K3Q3DzAswh4k2OIK2w-zJoZDCLGZcJEqDhAQMqkuZelII_RVjZIdHCY3-6CnSzthwxvp90Lm03lq_Tpft7O6lu7VS2UXqImAPuBmV5oPSlgE9809owZXU9v0Bw-zfGKAAAAA.dtVE252a_UspezdZW0FZjWmKy3kLFNMAVfdJGN-NFf8tn78XQfJUkzYTU0h145lHpPwJMQ9qMBg4hNL3o3iy0Q",
                        "Content-Type": "application/json"
                    }
                };

                $http(req).then(
                    function (response) {
                        console.log(response.data);
                        $scope.challenges = response.data.filter(function(challenge) {
                            return challenge.active;
                        });
                        $scope.loading = false;
                    },
                    function (err) {
                        console.log(err);
                        $scope.error = true;
                        $scope.loading = false;
                    }
                );
            }]);
    </script>
</body>
</html>